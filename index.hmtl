<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Painel Administrativo - Doce Lagom</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700&family=Playfair+Display:wght@400;500;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --creme: #F9F5F0;
            --terroso-claro: #E8D9C5;
            --terroso-medio: #D4B996;
            --verde-menta: #A3B8A3;
            --azul-acinzentado: #7A8B99;
            --marrom-escuro: #5D4A3E;
            --cinza-claro: #EAEAEA;
            --branco: #FFFFFF;
            --laranja: #E67E22;
            --vermelho: #E74C3C;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Montserrat', sans-serif;
            background-color: #f5f5f5;
            color: var(--marrom-escuro);
            line-height: 1.6;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        .login-container {
            background-color: var(--branco);
            border-radius: 15px;
            padding: 40px;
            width: 90%;
            max-width: 400px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }
        
        .admin-logo {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .admin-logo img {
            height: 80px;
            margin-bottom: 10px;
        }
        
        .admin-logo h1 {
            font-family: 'Playfair Display', serif;
            font-size: 1.8rem;
            color: var(--marrom-escuro);
        }
        
        .admin-logo p {
            font-size: 0.9rem;
            color: var(--azul-acinzentado);
            margin-top: 5px;
        }
        
        .login-form h2 {
            font-size: 1.5rem;
            margin-bottom: 20px;
            color: var(--marrom-escuro);
            text-align: center;
        }
        
        .login-form input {
            width: 100%;
            padding: 12px;
            margin-bottom: 15px;
            border: 1px solid var(--cinza-claro);
            border-radius: 8px;
            font-family: 'Montserrat', sans-serif;
        }
        
        .login-submit {
            width: 100%;
            padding: 12px;
            background-color: var(--verde-menta);
            color: var(--branco);
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.3s ease;
            font-size: 1rem;
        }
        
        .login-submit:hover {
            background-color: #8fa38f;
        }
        
        .login-error {
            color: var(--vermelho);
            font-size: 0.9rem;
            margin-top: 10px;
            text-align: center;
            display: none;
        }
        
        .message {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 25px;
            border-radius: 8px;
            font-weight: 500;
            z-index: 3000;
            animation: slideIn 0.3s ease forwards;
            max-width: 300px;
        }
        
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        .success {
            background-color: #2ecc71;
            color: white;
        }
        
        .error {
            background-color: #e74c3c;
            color: white;
        }
        
        /* Dashboard */
        .dashboard {
            display: none;
            width: 100%;
            min-height: 100vh;
            background-color: #f5f5f5;
        }
        
        .dashboard-header {
            background-color: var(--branco);
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .dashboard-title {
            font-family: 'Playfair Display', serif;
            font-size: 1.8rem;
            color: var(--marrom-escuro);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .admin-logout {
            background-color: var(--vermelho);
            color: var(--branco);
            border: none;
            padding: 10px 20px;
            border-radius: 20px;
            cursor: pointer;
            font-weight: 500;
            transition: background-color 0.3s ease;
        }
        
        .admin-logout:hover {
            background-color: #c0392b;
        }
        
        .dashboard-content {
            padding: 30px;
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            margin-bottom: 40px;
        }
        
        .dashboard-card {
            background-color: var(--branco);
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.08);
        }
        
        .dashboard-card h3 {
            color: var(--marrom-escuro);
            margin-bottom: 15px;
            font-size: 1.3rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }
        
        .stat-item {
            text-align: center;
            padding: 15px;
            border-radius: 8px;
            background-color: var(--creme);
        }
        
        .stat-value {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--verde-menta);
        }
        
        .stat-label {
            font-size: 0.9rem;
            color: var(--azul-acinzentado);
            margin-top: 5px;
        }
        
        .order-list, .product-list {
            max-height: 400px;
            overflow-y: auto;
        }
        
        .order-item, .product-item {
            padding: 15px;
            border-bottom: 1px solid var(--cinza-claro);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .order-item:last-child, .product-item:last-child {
            border-bottom: none;
        }
        
        .order-info h4, .product-info h4 {
            margin-bottom: 5px;
        }
        
        .order-details, .product-details {
            font-size: 0.9rem;
            color: var(--azul-acinzentado);
        }
        
        .order-status {
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: 600;
        }
        
        .status-pending {
            background-color: #FFF3CD;
            color: #856404;
        }
        
        .status-confirmed {
            background-color: #D4EDDA;
            color: #155724;
        }
        
        .status-delivered {
            background-color: #D1ECF1;
            color: #0C5460;
        }
        
        .product-stock {
            font-weight: 600;
        }
        
        .stock-low {
            color: var(--vermelho);
        }
        
        .stock-ok {
            color: var(--verde-menta);
        }
        
        .admin-actions {
            display: flex;
            gap: 10px;
        }
        
        .admin-btn {
            padding: 8px 15px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.3s ease;
        }
        
        .btn-edit {
            background-color: var(--verde-menta);
            color: var(--branco);
        }
        
        .btn-delete {
            background-color: var(--vermelho);
            color: var(--branco);
        }
        
        .btn-restock {
            background-color: var(--laranja);
            color: var(--branco);
        }
        
        .btn-update {
            background-color: var(--azul-acinzentado);
            color: var(--branco);
        }
        
        .order-date {
            font-size: 0.8rem;
            color: var(--azul-acinzentado);
            margin-top: 5px;
        }
        
        .back-to-login {
            text-align: center;
            margin-top: 20px;
        }
        
        .back-to-login a {
            color: var(--verde-menta);
            text-decoration: none;
            font-size: 0.9rem;
        }
        
        .back-to-login a:hover {
            text-decoration: underline;
        }
        
        /* Modal para atualização de status */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        
        .modal-content {
            background-color: var(--branco);
            padding: 30px;
            border-radius: 10px;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.2);
        }
        
        .modal-title {
            font-size: 1.4rem;
            margin-bottom: 20px;
            color: var(--marrom-escuro);
        }
        
        .status-options {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-bottom: 25px;
        }
        
        .status-option {
            display: flex;
            align-items: center;
            padding: 10px;
            border: 1px solid var(--cinza-claro);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .status-option:hover {
            background-color: var(--creme);
        }
        
        .status-option.selected {
            background-color: var(--creme);
            border-color: var(--verde-menta);
        }
        
        .status-radio {
            margin-right: 10px;
        }
        
        .modal-actions {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }
        
        .btn-cancel {
            background-color: var(--cinza-claro);
            color: var(--marrom-escuro);
        }
        
        .btn-save {
            background-color: var(--verde-menta);
            color: var(--branco);
        }
    </style>
</head>
<body>
    <!-- Tela de Login -->
    <div class="login-container" id="login-container">
        <div class="admin-logo">
            <img src="https://i.ibb.co/Zp2FXJPB/Chat-GPT-Image-18-de-jan-de-2026-16-00-28-removebg-preview.png" alt="Doce Lagom Logo">
            <h1>Doce Lagom</h1>
            <p>Painel Administrativo</p>
        </div>
        
        <form class="login-form" id="admin-login-form">
            <h2>Acesso Restrito</h2>
            <input type="text" id="admin-username" placeholder="Usuário" required>
            <input type="password" id="admin-password" placeholder="Senha" required>
            <button type="submit" class="login-submit">Entrar no Painel</button>
            <div class="login-error" id="admin-error"></div>
            
            <div class="back-to-login">
                <a href="index.html">← Voltar para o site</a>
            </div>
        </form>
    </div>

    <!-- Dashboard Administrativo -->
    <div class="dashboard" id="dashboard">
        <div class="dashboard-header">
            <h2 class="dashboard-title">
                <i class="fas fa-cog"></i> Painel Administrativo - Doce Lagom
            </h2>
            <button class="admin-logout" id="admin-logout">Sair do Painel</button>
        </div>
        
        <div class="dashboard-content">
            <div class="dashboard-grid">
                <!-- Resumo de Vendas -->
                <div class="dashboard-card">
                    <h3><i class="fas fa-chart-line"></i> Resumo de Vendas</h3>
                    <div class="stats-grid">
                        <div class="stat-item">
                            <div class="stat-value" id="total-sales">R$ 0,00</div>
                            <div class="stat-label">Total em Vendas</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="total-orders">0</div>
                            <div class="stat-label">Pedidos Totais</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="pending-orders">0</div>
                            <div class="stat-label">Pedidos Pendentes</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="avg-order">R$ 0,00</div>
                            <div class="stat-label">Ticket Médio</div>
                        </div>
                    </div>
                </div>
                
                <!-- Controle de Estoque -->
                <div class="dashboard-card">
                    <h3><i class="fas fa-boxes"></i> Controle de Estoque</h3>
                    <div class="product-list" id="admin-stock-list">
                        <!-- Produtos com estoque serão listados aqui -->
                    </div>
                </div>
                
                <!-- Pedidos Recentes -->
                <div class="dashboard-card">
                    <h3><i class="fas fa-shopping-cart"></i> Pedidos Recentes</h3>
                    <div class="order-list" id="admin-order-list">
                        <!-- Pedidos serão listados aqui -->
                    </div>
                </div>
                
                <!-- Produtos Mais Vendidos -->
                <div class="dashboard-card">
                    <h3><i class="fas fa-star"></i> Produtos Mais Vendidos</h3>
                    <div class="order-list" id="admin-best-sellers">
                        <!-- Produtos mais vendidos serão listados aqui -->
                    </div>
                </div>
            </div>
            
            <!-- Ações Rápidas -->
            <div class="dashboard-card">
                <h3><i class="fas fa-bolt"></i> Ações Rápidas</h3>
                <div style="display: flex; gap: 15px; margin-top: 15px;">
                    <button class="admin-btn btn-restock" id="btn-restock-all">
                        <i class="fas fa-redo"></i> Repor Todo o Estoque
                    </button>
                    <button class="admin-btn btn-edit" id="btn-export-data">
                        <i class="fas fa-download"></i> Exportar Dados
                    </button>
                    <button class="admin-btn btn-delete" id="btn-clear-data">
                        <i class="fas fa-trash"></i> Limpar Todos os Dados
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal para atualização de status do pedido -->
    <div class="modal-overlay" id="statusModal">
        <div class="modal-content">
            <h3 class="modal-title">Atualizar Status do Pedido</h3>
            <div class="status-options" id="statusOptions">
                <label class="status-option">
                    <input type="radio" name="orderStatus" value="pending" class="status-radio">
                    <span class="order-status status-pending">Pendente</span>
                    <span style="margin-left: 10px;">Pedido recebido, aguardando confirmação</span>
                </label>
                <label class="status-option">
                    <input type="radio" name="orderStatus" value="confirmed" class="status-radio">
                    <span class="order-status status-confirmed">Confirmado</span>
                    <span style="margin-left: 10px;">Pedido confirmado e em preparação</span>
                </label>
                <label class="status-option">
                    <input type="radio" name="orderStatus" value="delivered" class="status-radio">
                    <span class="order-status status-delivered">Entregue</span>
                    <span style="margin-left: 10px;">Pedido entregue ao cliente</span>
                </label>
            </div>
            <div class="modal-actions">
                <button class="admin-btn btn-cancel" id="btnCancelStatus">Cancelar</button>
                <button class="admin-btn btn-save" id="btnSaveStatus">Salvar Alterações</button>
            </div>
        </div>
    </div>

    <script>
        // Sistema de Banco de Dados Local (COMPARTILHADO com o site principal)
        const DB = {
            // Chaves do localStorage (MESMAS do site principal)
            KEYS: {
                PRODUCTS: 'doce_lagom_products',
                ORDERS: 'doce_lagom_orders',
                CUSTOMERS: 'doce_lagom_customers',
                ADMIN_LOGGED_IN: 'doce_lagom_admin_logged_in'
            },
            
            // Produtos
            getProducts: function() {
                return JSON.parse(localStorage.getItem(this.KEYS.PRODUCTS)) || this.getDefaultProducts();
            },
            
            getDefaultProducts: function() {
                return {
                    trufas: [
                        {
                            id: 1,
                            name: "Trufa de Ninho e Nutella",
                            price: 5.00,
                            sizes: [{ name: "Mini", price: 3.00 }, { name: "Média", price: 5.00 }],
                            stock: 10,
                            type: "trufa"
                        },
                        {
                            id: 2,
                            name: "Trufa de Brigadeiro",
                            price: 5.00,
                            sizes: [{ name: "Mini", price: 3.00 }, { name: "Média", price: 5.00 }],
                            stock: 10,
                            type: "trufa"
                        },
                        {
                            id: 3,
                            name: "Trufa de Maracujá",
                            price: 5.00,
                            sizes: [{ name: "Mini", price: 3.00 }, { name: "Média", price: 5.00 }],
                            stock: 10,
                            type: "trufa"
                        },
                        {
                            id: 4,
                            name: "Trufa de Paçoca e Café",
                            price: 5.00,
                            sizes: [{ name: "Mini", price: 3.00 }, { name: "Média", price: 5.00 }],
                            stock: 10,
                            type: "trufa"
                        }
                    ],
                    bolosPote: [
                        {
                            id: 5,
                            name: "Bolo de Pote Brigadeiro",
                            price: 12.00,
                            stock: 10,
                            type: "bolo"
                        },
                        {
                            id: 6,
                            name: "Bolo de Pote Ninho com Nutella",
                            price: 12.00,
                            stock: 10,
                            type: "bolo"
                        },
                        {
                            id: 7,
                            name: "Bolo de Pote Maracujá",
                            price: 12.00,
                            stock: 10,
                            type: "bolo"
                        }
                    ],
                    combos: [
                        {
                            id: 8,
                            name: "Duo Lagom",
                            price: 20.00,
                            stock: 10,
                            type: "combo"
                        },
                        {
                            id: 9,
                            name: "Trio de Médias",
                            price: 15.00,
                            stock: 10,
                            type: "combo"
                        },
                        {
                            id: 10,
                            name: "Kit Degustação (5 Minis)",
                            price: 15.00,
                            stock: 10,
                            type: "combo"
                        }
                    ]
                };
            },
            
            saveProducts: function(products) {
                localStorage.setItem(this.KEYS.PRODUCTS, JSON.stringify(products));
            },
            
            updateProductStock: function(productId, newStock) {
                const products = this.getProducts();
                
                // Procurar em trufas
                let product = products.trufas.find(p => p.id === productId);
                if (product) {
                    product.stock = newStock;
                    this.saveProducts(products);
                    return true;
                }
                
                // Procurar em bolos
                product = products.bolosPote.find(p => p.id === productId);
                if (product) {
                    product.stock = newStock;
                    this.saveProducts(products);
                    return true;
                }
                
                // Procurar em combos
                product = products.combos.find(p => p.id === productId);
                if (product) {
                    product.stock = newStock;
                    this.saveProducts(products);
                    return true;
                }
                
                return false;
            },
            
            // Pedidos
            getOrders: function() {
                return JSON.parse(localStorage.getItem(this.KEYS.ORDERS)) || [];
            },
            
            saveOrders: function(orders) {
                localStorage.setItem(this.KEYS.ORDERS, JSON.stringify(orders));
            },
            
            updateOrderStatus: function(orderId, newStatus) {
                const orders = this.getOrders();
                const orderIndex = orders.findIndex(order => order.id === orderId);
                
                if (orderIndex !== -1) {
                    orders[orderIndex].status = newStatus;
                    this.saveOrders(orders);
                    return true;
                }
                
                return false;
            },
            
            getOrderById: function(orderId) {
                const orders = this.getOrders();
                return orders.find(order => order.id === orderId);
            },
            
            // Clientes
            getCustomers: function() {
                return JSON.parse(localStorage.getItem(this.KEYS.CUSTOMERS)) || [];
            },
            
            // Admin
            isAdminLoggedIn: function() {
                return localStorage.getItem(this.KEYS.ADMIN_LOGGED_IN) === 'true';
            },
            
            setAdminLoggedIn: function(loggedIn) {
                localStorage.setItem(this.KEYS.ADMIN_LOGGED_IN, loggedIn.toString());
            },
            
            // Dashboard stats
            getDashboardStats: function() {
                const orders = this.getOrders();
                const products = this.getProducts();
                const allProducts = [...products.trufas, ...products.bolosPote, ...products.combos];
                
                const totalSales = orders.reduce((sum, order) => sum + order.total, 0);
                const totalOrders = orders.length;
                const pendingOrders = orders.filter(o => o.status === 'pending').length;
                const avgOrder = totalOrders > 0 ? totalSales / totalOrders : 0;
                
                // Calcular produtos mais vendidos
                const productSales = {};
                orders.forEach(order => {
                    order.items.forEach(item => {
                        if (!productSales[item.name]) {
                            productSales[item.name] = 0;
                        }
                        productSales[item.name] += item.quantity;
                    });
                });
                
                const bestSellers = Object.entries(productSales)
                    .map(([name, quantity]) => ({ name, quantity }))
                    .sort((a, b) => b.quantity - a.quantity)
                    .slice(0, 5);
                
                return {
                    totalSales,
                    totalOrders,
                    pendingOrders,
                    avgOrder,
                    bestSellers,
                    lowStockProducts: allProducts.filter(p => p.stock <= 3)
                };
            },
            
            // Exportar dados
            exportData: function() {
                const data = {
                    products: this.getProducts(),
                    orders: this.getOrders(),
                    customers: this.getCustomers(),
                    exportDate: new Date().toISOString()
                };
                
                const dataStr = JSON.stringify(data, null, 2);
                const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
                
                const exportFileDefaultName = `doce_lagom_backup_${new Date().toISOString().split('T')[0]}.json`;
                
                const linkElement = document.createElement('a');
                linkElement.setAttribute('href', dataUri);
                linkElement.setAttribute('download', exportFileDefaultName);
                linkElement.click();
            },
            
            // Limpar todos os dados
            clearAllData: function() {
                if (confirm('Tem certeza que deseja limpar TODOS os dados? Esta ação não pode ser desfeita!')) {
                    localStorage.removeItem(this.KEYS.PRODUCTS);
                    localStorage.removeItem(this.KEYS.ORDERS);
                    localStorage.removeItem(this.KEYS.CUSTOMERS);
                    localStorage.setItem(this.KEYS.ADMIN_LOGGED_IN, 'false');
                    return true;
                }
                return false;
            },
            
            // Repor todo o estoque
            restockAllProducts: function() {
                const products = this.getProducts();
                
                products.trufas.forEach(p => p.stock = 10);
                products.bolosPote.forEach(p => p.stock = 10);
                products.combos.forEach(p => p.stock = 10);
                
                this.saveProducts(products);
                return true;
            }
        };

        // Estado da aplicação (PAINEL ADMIN)
        const AdminState = {
            isLoggedIn: false,
            currentOrderId: null,
            
            init: function() {
                this.isLoggedIn = DB.isAdminLoggedIn();
                
                if (this.isLoggedIn) {
                    this.showDashboard();
                }
            },
            
            login: function(username, password) {
                // Credenciais padrão do admin - CORRIGIDO
                const ADMIN_CREDENTIALS = {
                    username: 'admin',
                    password: 'lagom123'
                };
                
                if (username === ADMIN_CREDENTIALS.username && password === ADMIN_CREDENTIALS.password) {
                    this.isLoggedIn = true;
                    DB.setAdminLoggedIn(true);
                    this.showDashboard();
                    return true;
                } else {
                    console.log('Login falhou:', {username, password, expected: ADMIN_CREDENTIALS});
                }
                return false;
            },
            
            logout: function() {
                this.isLoggedIn = false;
                DB.setAdminLoggedIn(false);
                this.showLogin();
            },
            
            showLogin: function() {
                document.getElementById('login-container').style.display = 'block';
                document.getElementById('dashboard').style.display = 'none';
            },
            
            showDashboard: function() {
                document.getElementById('login-container').style.display = 'none';
                document.getElementById('dashboard').style.display = 'block';
                this.renderDashboard();
            },
            
            renderDashboard: function() {
                const stats = DB.getDashboardStats();
                const products = DB.getProducts();
                const allProducts = [...products.trufas, ...products.bolosPote, ...products.combos];
                const orders = DB.getOrders().slice(-10).reverse(); // Últimos 10 pedidos (mais recentes primeiro)
                
                // Atualizar estatísticas
                document.getElementById('total-sales').textContent = `R$ ${stats.totalSales.toFixed(2)}`;
                document.getElementById('total-orders').textContent = stats.totalOrders;
                document.getElementById('pending-orders').textContent = stats.pendingOrders;
                document.getElementById('avg-order').textContent = `R$ ${stats.avgOrder.toFixed(2)}`;
                
                // Renderizar estoque
                const stockList = document.getElementById('admin-stock-list');
                stockList.innerHTML = '';
                
                allProducts.forEach(product => {
                    const stockItem = document.createElement('div');
                    stockItem.className = 'product-item';
                    stockItem.innerHTML = `
                        <div class="product-info">
                            <h4>${product.name}</h4>
                            <div class="product-details">Estoque atual: <span class="product-stock ${product.stock <= 3 ? 'stock-low' : 'stock-ok'}">${product.stock}</span></div>
                        </div>
                        <div class="admin-actions">
                            <button class="admin-btn btn-restock restock-product" data-id="${product.id}">
                                <i class="fas fa-redo"></i> Repor
                            </button>
                        </div>
                    `;
                    stockList.appendChild(stockItem);
                });
                
                // Renderizar pedidos recentes
                const orderList = document.getElementById('admin-order-list');
                orderList.innerHTML = '';
                
                if (orders.length === 0) {
                    orderList.innerHTML = '<div style="text-align: center; padding: 20px; color: var(--azul-acinzentado);">Nenhum pedido encontrado</div>';
                } else {
                    orders.forEach(order => {
                        const orderItem = document.createElement('div');
                        orderItem.className = 'order-item';
                        orderItem.innerHTML = `
                            <div class="order-info">
                                <h4>Pedido #${order.id.toString().slice(-6)}</h4>
                                <div class="order-details">${order.customerName} - ${order.items.length} item(s) - R$ ${order.total.toFixed(2)}</div>
                                <div class="order-date">${new Date(order.date).toLocaleDateString('pt-BR')} ${new Date(order.date).toLocaleTimeString('pt-BR')}</div>
                            </div>
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <span class="order-status status-${order.status}">${order.status === 'pending' ? 'Pendente' : order.status === 'confirmed' ? 'Confirmado' : 'Entregue'}</span>
                                <button class="admin-btn btn-update update-order-status" data-id="${order.id}" data-status="${order.status}">
                                    <i class="fas fa-edit"></i> Atualizar
                                </button>
                            </div>
                        `;
                        orderList.appendChild(orderItem);
                    });
                }
                
                // Renderizar produtos mais vendidos
                const bestSellersList = document.getElementById('admin-best-sellers');
                bestSellersList.innerHTML = '';
                
                if (stats.bestSellers.length === 0) {
                    bestSellersList.innerHTML = '<div style="text-align: center; padding: 20px; color: var(--azul-acinzentado);">Nenhuma venda registrada</div>';
                } else {
                    stats.bestSellers.forEach(item => {
                        const sellerItem = document.createElement('div');
                        sellerItem.className = 'order-item';
                        sellerItem.innerHTML = `
                            <div class="order-info">
                                <h4>${item.name}</h4>
                            </div>
                            <div>
                                <span class="order-status status-confirmed">${item.quantity} vendas</span>
                            </div>
                        `;
                        bestSellersList.appendChild(sellerItem);
                    });
                }
                
                // Adicionar event listeners para botões de ação
                document.querySelectorAll('.restock-product').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const productId = parseInt(this.dataset.id);
                        DB.updateProductStock(productId, 10);
                        showMessage('success', 'Estoque reposto com sucesso!');
                        AdminState.renderDashboard();
                    });
                });
                
                // Adicionar event listeners para botões de atualização de status
                document.querySelectorAll('.update-order-status').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const orderId = this.dataset.id;
                        const currentStatus = this.dataset.status;
                        AdminState.openStatusModal(orderId, currentStatus);
                    });
                });
            },
            
            openStatusModal: function(orderId, currentStatus) {
                this.currentOrderId = orderId;
                
                // Selecionar o status atual no modal
                const statusRadios = document.querySelectorAll('input[name="orderStatus"]');
                statusRadios.forEach(radio => {
                    if (radio.value === currentStatus) {
                        radio.checked = true;
                        radio.closest('.status-option').classList.add('selected');
                    } else {
                        radio.closest('.status-option').classList.remove('selected');
                    }
                });
                
                // Mostrar o modal
                document.getElementById('statusModal').style.display = 'flex';
            },
            
            closeStatusModal: function() {
                document.getElementById('statusModal').style.display = 'none';
                this.currentOrderId = null;
            },
            
            updateOrderStatus: function(newStatus) {
                if (!this.currentOrderId) return false;
                
                const orderId = typeof this.currentOrderId === 'string' ? this.currentOrderId : String(this.currentOrderId);
                const success = DB.updateOrderStatus(orderId, newStatus);
                
                if (success) {
                    const order = DB.getOrderById(orderId);
                    showMessage('success', `Status do pedido #${order.id.toString().slice(-6)} atualizado para: ${newStatus === 'pending' ? 'Pendente' : newStatus === 'confirmed' ? 'Confirmado' : 'Entregue'}`);
                    this.renderDashboard();
                }
                
                return success;
            }
        };

        // Função para mostrar mensagens
        function showMessage(type, text) {
            // Remover mensagem anterior se existir
            const existingMessage = document.querySelector('.message');
            if (existingMessage) {
                existingMessage.remove();
            }
            
            // Criar nova mensagem
            const message = document.createElement('div');
            message.className = `message ${type}`;
            message.textContent = text;
            
            document.body.appendChild(message);
            
            // Remover após 3 segundos
            setTimeout(() => {
                if (message.parentNode) {
                    message.remove();
                }
            }, 3000);
        }

        // Inicialização
        document.addEventListener('DOMContentLoaded', function() {
            // Inicializar estado do admin
            AdminState.init();
            
            // Login do admin - CORRIGIDO
            document.getElementById('admin-login-form').addEventListener('submit', function(e) {
                e.preventDefault();
                const username = document.getElementById('admin-username').value.trim();
                const password = document.getElementById('admin-password').value.trim();
                
                if (!username || !password) {
                    document.getElementById('admin-error').textContent = 'Por favor, preencha todos os campos!';
                    document.getElementById('admin-error').style.display = 'block';
                    return;
                }
                
                // Testar as credenciais
                console.log('Tentando login com:', {username, password});
                
                if (AdminState.login(username, password)) {
                    this.reset();
                    document.getElementById('admin-error').style.display = 'none';
                    console.log('Login bem-sucedido!');
                } else {
                    document.getElementById('admin-error').textContent = 'Credenciais inválidas! Use: admin / lagom123';
                    document.getElementById('admin-error').style.display = 'block';
                    console.log('Login falhou!');
                }
            });
            
            // Logout do admin
            document.getElementById('admin-logout').addEventListener('click', function() {
                AdminState.logout();
            });
            
            // Ações do admin dashboard
            document.getElementById('btn-restock-all').addEventListener('click', function() {
                if (DB.restockAllProducts()) {
                    showMessage('success', 'Todo o estoque foi reposto!');
                    AdminState.renderDashboard();
                }
            });
            
            document.getElementById('btn-export-data').addEventListener('click', function() {
                DB.exportData();
                showMessage('success', 'Dados exportados com sucesso!');
            });
            
            document.getElementById('btn-clear-data').addEventListener('click', function() {
                if (DB.clearAllData()) {
                    showMessage('info', 'Todos os dados foram limpos!');
                    AdminState.renderDashboard();
                }
            });
            
            // Controle do modal de status
            document.getElementById('btnCancelStatus').addEventListener('click', function() {
                AdminState.closeStatusModal();
            });
            
            document.getElementById('btnSaveStatus').addEventListener('click', function() {
                const selectedStatus = document.querySelector('input[name="orderStatus"]:checked');
                if (selectedStatus) {
                    AdminState.updateOrderStatus(selectedStatus.value);
                    AdminState.closeStatusModal();
                } else {
                    showMessage('error', 'Selecione um status para o pedido!');
                }
            });
            
            // Fechar modal ao clicar fora
            document.getElementById('statusModal').addEventListener('click', function(e) {
                if (e.target === this) {
                    AdminState.closeStatusModal();
                }
            });
            
            // Estilizar opções de status no modal
            const statusOptions = document.querySelectorAll('.status-option');
            statusOptions.forEach(option => {
                option.addEventListener('click', function() {
                    // Remover seleção de todas as opções
                    statusOptions.forEach(opt => opt.classList.remove('selected'));
                    
                    // Adicionar seleção à opção clicada
                    this.classList.add('selected');
                    
                    // Marcar o radio button
                    const radio = this.querySelector('.status-radio');
                    if (radio) radio.checked = true;
                });
                
                // Garantir que o radio button seja marcado quando clicar na opção
                const radio = option.querySelector('.status-radio');
                radio.addEventListener('change', function() {
                    if (this.checked) {
                        statusOptions.forEach(opt => opt.classList.remove('selected'));
                        option.classList.add('selected');
                    }
                });
            });
            
            // Debug: Mostrar credenciais na página para facilitar
            console.log('Credenciais do Admin: usuário = "admin", senha = "lagom123"');
            
            // Adicionar uma dica visual (opcional, pode remover depois)
            setTimeout(() => {
                if (!AdminState.isLoggedIn) {
                    console.log('Dica: Use admin / lagom123 para fazer login');
                }
            }, 1000);
        });
    </script>
</body>
</html>
